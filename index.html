<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Russland p√• langs</title>
    <!--<script src="bower_components/Snap.svg/dist/snap.svg-min.js"></script>-->
    <script src="bower_components/svg-pan-zoom/dist/svg-pan-zoom.js"></script>
    <link rel="stylesheet" href="styles.css"/>
</head>
<body>

<object id="map" data="world/world_finished.svg" type="image/svg+xml"></object>

<script>
    waitUntilEverythingsIsLoaded();


    function waitUntilEverythingsIsLoaded() {
        document.addEventListener("DOMContentLoaded", function () {
            var svgEl = document.getElementById("map");

            svgEl.addEventListener("load", function () {
                start(svgEl);
            });
        });
    }


    function start(svgEl) {
        var svg = svgEl.contentDocument;
        var path = svg.querySelector("#path path");
        var cities = svg.querySelectorAll("#cities circle");

        animatePath();
        addCitiesTooltips();

        var panZoom = svgPanZoom(svgEl, {
            maxZoom: 50,
            minZoom: 1,
            onZoom: function(zoom) {
                adjustPathStrokeToZoom(zoom);
                adjustCitiesToZoom(zoom);
            },
            beforePan: beforePan
        });


        function adjustPathStrokeToZoom(zoom) {
            var strokeWidth = 3 / zoom;

            if (strokeWidth < 0.3) {
                strokeWidth = 0.3;
            }

            path.style.strokeWidth = strokeWidth;
        }

        function adjustCitiesToZoom(zoom) {
            var radius = 3 / (0.5*zoom);
            if (radius > 3) {
                radius = 3;
            }

            for (var i = 0; i < cities.length; i++) {
                var city = cities[i];
                city.setAttribute("r", radius);
            }
        }


        function beforePan(oldPan, newPan) {
            var sizes = this.getSizes();

            var rightLimit = -((sizes.viewBox.width) * sizes.realZoom) + sizes.viewBox.width;
            var leftLimit = 0;

            var topLimit = 0;
            var bottomLimit = -(sizes.viewBox.height * sizes.realZoom) + sizes.viewBox.height;

            var customPan = {};
            customPan.x = Math.max(rightLimit, Math.min(leftLimit, newPan.x));
            customPan.y = Math.max(bottomLimit, Math.min(topLimit, newPan.y));

            return customPan;
        }

        function animatePath() {
            setTimeout(function () {
                path.style["stroke-dashoffset"] = "0";
            }, 50);
        }

        function addCitiesTooltips() {
            for (var i = 0; i < cities.length; i++) {
                var city = cities[i];
                city.addEventListener("mouseover", function() {
                    console.log("hey");
                });
            }
        }
    }
</script>

</body>
</html>